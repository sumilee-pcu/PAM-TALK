<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESG-Gold Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 15px;
        }

        .icon-gold {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
        }

        .icon-carbon {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
        }

        .icon-activity {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .icon-discount {
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
        }

        .card-title {
            font-size: 1.1em;
            color: #666;
            font-weight: 500;
        }

        .card-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
            margin: 15px 0;
        }

        .card-subtitle {
            color: #999;
            font-size: 0.9em;
        }

        .highlight-gold {
            color: #f6d365;
        }

        .highlight-green {
            color: #84fab0;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            color: white;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .activity-form {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .preview-card {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .preview-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .preview-item:last-child {
            border-bottom: none;
        }

        .preview-label {
            color: #666;
            font-weight: 500;
        }

        .preview-value {
            color: #333;
            font-weight: bold;
        }

        .activity-list {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .activity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.3s ease;
        }

        .activity-item:hover {
            background: #f9f9f9;
        }

        .activity-info {
            flex: 1;
        }

        .activity-type {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }

        .activity-details {
            color: #999;
            font-size: 0.9em;
        }

        .activity-reward {
            text-align: right;
        }

        .reward-amount {
            font-size: 1.3em;
            font-weight: bold;
            color: #f6d365;
        }

        .reward-carbon {
            color: #84fab0;
            font-size: 0.9em;
        }

        .wallet-input {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-success {
            background: #84fab0;
            color: white;
        }

        .status-pending {
            background: #fda085;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ¿ ESG-Gold Dashboard</h1>
            <p>1 DC = 1 kg COâ‚‚ ê°ì¶•ëŸ‰</p>
        </div>

        <!-- ì§€ê°‘ ì£¼ì†Œ ì…ë ¥ -->
        <div class="wallet-input">
            <h2 style="margin-bottom: 15px;">ì§€ê°‘ ì—°ê²°</h2>
            <div class="form-group">
                <input type="text" id="walletAddress" placeholder="Algorand ì§€ê°‘ ì£¼ì†Œ ì…ë ¥">
                <button class="btn btn-primary" onclick="loadWalletData()" style="margin-top: 10px; width: 100%;">
                    ì§€ê°‘ ì—°ê²°
                </button>
            </div>
        </div>

        <!-- Dashboard Cards -->
        <div class="dashboard">
            <!-- ESG-Gold Balance Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-gold">ğŸ’°</div>
                    <div class="card-title">ESG-Gold ì”ì•¡</div>
                </div>
                <div class="card-value highlight-gold" id="esgGoldBalance">0.00</div>
                <div class="card-subtitle">DC (Digital Carbon)</div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="showTransferModal()">ì „ì†¡</button>
                    <button class="btn btn-secondary" onclick="showBurnModal()">ì†Œê°</button>
                </div>
            </div>

            <!-- Carbon Offset Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-carbon">ğŸŒ±</div>
                    <div class="card-title">íƒ„ì†Œ ìƒì‡„ëŸ‰</div>
                </div>
                <div class="card-value highlight-green" id="carbonOffset">0.00</div>
                <div class="card-subtitle">kg COâ‚‚ ê°ì¶•</div>
                <div style="margin-top: 15px; padding: 15px; background: #f0f9ff; border-radius: 8px;">
                    <div style="font-size: 0.9em; color: #666;">ë‚˜ë¬´ í™˜ì‚°: <strong id="treeEquivalent">0</strong>ê·¸ë£¨</div>
                </div>
            </div>

            <!-- Total Activities Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-activity">ğŸ“Š</div>
                    <div class="card-title">ì´ í™œë™ ìˆ˜</div>
                </div>
                <div class="card-value" id="totalActivities">0</div>
                <div class="card-subtitle">íƒ„ì†Œ ê°ì¶• í™œë™</div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="showActivityForm()">í™œë™ ë“±ë¡</button>
                </div>
            </div>

            <!-- Marketplace Discount Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-discount">ğŸ›’</div>
                    <div class="card-title">í• ì¸ í˜œíƒ</div>
                </div>
                <div class="card-value" id="totalDiscounts">â‚©0</div>
                <div class="card-subtitle">ë§ˆì¼“í”Œë ˆì´ìŠ¤ í• ì¸ ì´ì•¡</div>
                <div style="margin-top: 15px; font-size: 0.9em; color: #666;">
                    1 DC = â‚©1 í• ì¸ (ìµœëŒ€ 20%)
                </div>
            </div>
        </div>

        <!-- Activity Form -->
        <div class="activity-form" id="activityForm" style="display: none;">
            <h2 style="margin-bottom: 25px;">íƒ„ì†Œ ê°ì¶• í™œë™ ë“±ë¡</h2>

            <div class="form-grid">
                <div class="form-group">
                    <label>í™œë™ ìœ í˜•</label>
                    <select id="activityType" onchange="updatePreview()">
                        <option value="local_food_purchase">ì§€ì—­ ë¨¹ê±°ë¦¬ êµ¬ë§¤</option>
                        <option value="organic_farming">ìœ ê¸°ë† ë†ì‚¬</option>
                        <option value="renewable_energy">ì¬ìƒì—ë„ˆì§€ ì‚¬ìš©</option>
                        <option value="waste_reduction">íê¸°ë¬¼ ê°ì¶•</option>
                        <option value="transport_reduction">ìš´ì†¡ ê°ì¶•</option>
                        <option value="packaging_reduction">í¬ì¥ ê°ì¶•</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ì œí’ˆëª…</label>
                    <input type="text" id="productName" placeholder="ì˜ˆ: ìœ ê¸°ë† í† ë§ˆí† " onchange="updatePreview()">
                </div>

                <div class="form-group">
                    <label>ìˆ˜ëŸ‰ (kg)</label>
                    <input type="number" id="quantity" placeholder="2.0" step="0.1" onchange="updatePreview()">
                </div>

                <div class="form-group">
                    <label>ìƒì‚° ì§€ì—­</label>
                    <select id="originRegion" onchange="updatePreview()">
                        <option value="ê²½ê¸°ë„">ê²½ê¸°ë„</option>
                        <option value="ê°•ì›ë„">ê°•ì›ë„</option>
                        <option value="ì¶©ì²­ë‚¨ë„">ì¶©ì²­ë‚¨ë„</option>
                        <option value="ì „ë¼ë‚¨ë„">ì „ë¼ë‚¨ë„</option>
                        <option value="ê²½ìƒë¶ë„">ê²½ìƒë¶ë„</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ë°°ì†¡ ì§€ì—­</label>
                    <select id="destinationRegion" onchange="updatePreview()">
                        <option value="ì„œìš¸ì‹œ">ì„œìš¸ì‹œ</option>
                        <option value="ë¶€ì‚°ì‹œ">ë¶€ì‚°ì‹œ</option>
                        <option value="ëŒ€êµ¬ì‹œ">ëŒ€êµ¬ì‹œ</option>
                        <option value="ì¸ì²œì‹œ">ì¸ì²œì‹œ</option>
                        <option value="ê´‘ì£¼ì‹œ">ê´‘ì£¼ì‹œ</option>
                        <option value="ëŒ€ì „ì‹œ">ëŒ€ì „ì‹œ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ë†ë²•</label>
                    <select id="farmingMethod" onchange="updatePreview()">
                        <option value="organic">ìœ ê¸°ë†</option>
                        <option value="conventional">ì¼ë°˜ë†ë²•</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ìš´ì†¡ ë°©ë²•</label>
                    <select id="transportMethod" onchange="updatePreview()">
                        <option value="truck_small">ì†Œí˜• íŠ¸ëŸ­</option>
                        <option value="truck_medium">ì¤‘í˜• íŠ¸ëŸ­</option>
                        <option value="truck_large">ëŒ€í˜• íŠ¸ëŸ­</option>
                        <option value="rail">ì² ë„</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>í¬ì¥ì¬</label>
                    <select id="packagingType" onchange="updatePreview()">
                        <option value="paper">ì¢…ì´</option>
                        <option value="biodegradable">ìƒë¶„í•´ì„±</option>
                        <option value="reusable">ì¬ì‚¬ìš©</option>
                        <option value="plastic">í”Œë¼ìŠ¤í‹±</option>
                    </select>
                </div>
            </div>

            <!-- Preview -->
            <div class="preview-card" id="previewCard" style="display: none;">
                <h3 style="margin-bottom: 15px;">ì˜ˆìƒ ë³´ìƒ</h3>
                <div class="preview-item">
                    <span class="preview-label">íƒ„ì†Œ ì ˆì•½ëŸ‰</span>
                    <span class="preview-value highlight-green"><span id="previewCarbon">0.00</span> kg COâ‚‚</span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">DC íšë“</span>
                    <span class="preview-value highlight-gold"><span id="previewDC">0.00</span> DC</span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">ESG-Gold</span>
                    <span class="preview-value"><span id="previewESG">0.00</span> ESG-GOLD</span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">PAM í† í°</span>
                    <span class="preview-value"><span id="previewPAM">0</span> PAM</span>
                </div>
            </div>

            <div class="button-group" style="margin-top: 25px;">
                <button class="btn btn-secondary" onclick="hideActivityForm()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="submitActivity()">í™œë™ ë“±ë¡</button>
            </div>
        </div>

        <!-- Recent Activities -->
        <div class="activity-list">
            <h2 style="margin-bottom: 20px;">ìµœê·¼ í™œë™</h2>
            <div id="activityListContainer">
                <div class="loading">í™œë™ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:5000/api/esg-gold';
        let currentWallet = '';

        // ì§€ê°‘ ë°ì´í„° ë¡œë“œ
        async function loadWalletData() {
            const walletAddress = document.getElementById('walletAddress').value.trim();
            if (!walletAddress) {
                alert('ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            currentWallet = walletAddress;

            try {
                // ì”ì•¡ ì¡°íšŒ
                const balanceResponse = await fetch(`${API_BASE_URL}/balance/${walletAddress}`);
                const balanceData = await balanceResponse.json();

                if (balanceData.success) {
                    const data = balanceData.data;
                    document.getElementById('esgGoldBalance').textContent = data.balance_dc.toFixed(2);
                    document.getElementById('carbonOffset').textContent = data.carbon_offset.carbon_offset_kg.toFixed(2);
                    document.getElementById('treeEquivalent').textContent = data.carbon_offset.trees_equivalent.toFixed(1);
                }

                // ì‚¬ìš©ì í†µê³„ ì¡°íšŒ (user_idê°€ ìˆëŠ” ê²½ìš°)
                // TODO: Implement user stats API call

            } catch (error) {
                console.error('Failed to load wallet data:', error);
                alert('ì§€ê°‘ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
            }
        }

        // í™œë™ í¼ í‘œì‹œ
        function showActivityForm() {
            document.getElementById('activityForm').style.display = 'block';
            document.getElementById('activityForm').scrollIntoView({ behavior: 'smooth' });
        }

        function hideActivityForm() {
            document.getElementById('activityForm').style.display = 'none';
        }

        // ë³´ìƒ ë¯¸ë¦¬ë³´ê¸°
        async function updatePreview() {
            const activityData = {
                activity_type: document.getElementById('activityType').value,
                product_name: document.getElementById('productName').value,
                quantity: parseFloat(document.getElementById('quantity').value) || 0,
                origin_region: document.getElementById('originRegion').value,
                destination_region: document.getElementById('destinationRegion').value,
                farming_method: document.getElementById('farmingMethod').value,
                transport_method: document.getElementById('transportMethod').value,
                packaging_type: document.getElementById('packagingType').value
            };

            if (activityData.quantity === 0) return;

            try {
                const response = await fetch(`${API_BASE_URL}/activity/preview`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(activityData)
                });

                const result = await response.json();

                if (result.success) {
                    const data = result.data;
                    document.getElementById('previewCarbon').textContent = data.carbon_savings_kg.toFixed(2);
                    document.getElementById('previewDC').textContent = data.dc_units.toFixed(2);
                    document.getElementById('previewESG').textContent = data.esg_gold_amount.toFixed(6);
                    document.getElementById('previewPAM').textContent = data.pam_tokens;
                    document.getElementById('previewCard').style.display = 'block';
                }
            } catch (error) {
                console.error('Preview failed:', error);
            }
        }

        // í™œë™ ì œì¶œ
        async function submitActivity() {
            if (!currentWallet) {
                alert('ë¨¼ì € ì§€ê°‘ì„ ì—°ê²°í•´ì£¼ì„¸ìš”.');
                return;
            }

            // Note: ì‹¤ì œë¡œëŠ” private keyë¥¼ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤
            alert('í™œë™ ì œì¶œ ê¸°ëŠ¥ì€ ë°±ì—”ë“œì™€ì˜ í†µí•©ì´ í•„ìš”í•©ë‹ˆë‹¤.\nì§€ê°‘ ì„œëª…ì„ í†µí•œ ì•ˆì „í•œ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ê°€ êµ¬í˜„ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.');
        }

        // ì „ì†¡ ëª¨ë‹¬
        function showTransferModal() {
            alert('ESG-Gold ì „ì†¡ ê¸°ëŠ¥\nêµ¬í˜„ ì˜ˆì •');
        }

        // ì†Œê° ëª¨ë‹¬
        function showBurnModal() {
            alert('ESG-Gold ì†Œê° ê¸°ëŠ¥\níƒ„ì†Œ í¬ë ˆë”§ ì˜êµ¬ ìƒì‡„ìš©');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        window.addEventListener('load', () => {
            console.log('ESG-Gold Dashboard initialized');
        });
    </script>
</body>
</html>
