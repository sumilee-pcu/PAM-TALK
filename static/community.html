<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì»¤ë®¤ë‹ˆí‹° | PAM-TALK</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* í—¤ë” */
        header {
            background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            flex-shrink: 0;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 2rem;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #27ae60;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: #333;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            position: relative;
        }

        .nav-links a:hover {
            color: #27ae60;
        }

        .nav-links a.active {
            color: #27ae60;
            font-weight: 600;
        }

        .nav-links a.active::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 100%;
            height: 2px;
            background: #27ae60;
        }

        .user-status {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            cursor: pointer;
        }

        .online-indicator {
            width: 8px;
            height: 8px;
            background: #28a745;
            border-radius: 50%;
            border: 2px solid white;
            position: relative;
            top: -2px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* ë©”ì¸ ì±„íŒ… ë ˆì´ì•„ì›ƒ */
        .chat-container {
            display: flex;
            flex: 1;
            height: calc(100vh - 70px);
            overflow: hidden;
        }

        /* ì‚¬ì´ë“œë°” - ì±„íŒ…ë£¸ ëª©ë¡ */
        .chat-sidebar {
            width: 300px;
            background: #fff;
            border-right: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
            background: #f8f9fa;
        }

        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .sidebar-subtitle {
            font-size: 0.9rem;
            color: #666;
        }

        .room-categories {
            flex: 1;
            overflow-y: auto;
        }

        .category-section {
            margin-bottom: 1rem;
        }

        .category-title {
            padding: 1rem 1.5rem 0.5rem;
            font-size: 0.8rem;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .room-list {
            list-style: none;
        }

        .room-item {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-left: 3px solid transparent;
        }

        .room-item:hover {
            background: #f8f9fa;
        }

        .room-item.active {
            background: #e8f5e8;
            border-left-color: #27ae60;
            font-weight: 600;
        }

        .room-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .room-icon {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
        }

        .room-icon.global { background: linear-gradient(45deg, #667eea, #764ba2); }
        .room-icon.local { background: linear-gradient(45deg, #f093fb, #f5576c); }
        .room-icon.group { background: linear-gradient(45deg, #4facfe, #00f2fe); }
        .room-icon.dm { background: linear-gradient(45deg, #43e97b, #38f9d7); }
        .room-icon.announce { background: linear-gradient(45deg, #fa709a, #fee140); }

        .room-details h4 {
            font-size: 0.9rem;
            margin-bottom: 0.2rem;
        }

        .room-details .room-status {
            font-size: 0.8rem;
            color: #666;
        }

        .room-badges {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .unread-badge {
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .online-count {
            background: #28a745;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        /* ë©”ì¸ ì±„íŒ… ì˜ì—­ */
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #fff;
        }

        .chat-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e9ecef;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .chat-title h2 {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .chat-description {
            font-size: 0.9rem;
            color: #666;
        }

        .chat-actions {
            display: flex;
            gap: 0.5rem;
        }

        .chat-action-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #dee2e6;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .chat-action-btn:hover {
            background: #f8f9fa;
            border-color: #27ae60;
        }

        /* ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            display: flex;
            gap: 0.75rem;
            animation: fadeInUp 0.3s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.own {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .message-content {
            max-width: 70%;
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .message.own .message-content {
            align-items: flex-end;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
        }

        .message.own .message-header {
            flex-direction: row-reverse;
        }

        .message-author {
            font-weight: 600;
            color: #333;
        }

        .message-time {
            color: #888;
        }

        .user-type {
            background: #e9ecef;
            color: #666;
            padding: 0.1rem 0.4rem;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .user-type.farmer { background: #d4edda; color: #155724; }
        .user-type.consumer { background: #d1ecf1; color: #0c5460; }
        .user-type.restaurant { background: #f8d7da; color: #721c24; }

        .message-bubble {
            background: #f8f9fa;
            padding: 0.75rem 1rem;
            border-radius: 18px;
            position: relative;
            border: 1px solid #e9ecef;
            word-wrap: break-word;
        }

        .message.own .message-bubble {
            background: #27ae60;
            color: white;
            border-color: #27ae60;
        }

        .eco-message {
            border: 2px solid #28a745;
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            position: relative;
        }

        .eco-message::before {
            content: 'ğŸŒ±';
            position: absolute;
            top: -8px;
            right: -8px;
            background: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .eco-points {
            font-weight: bold;
            color: #28a745;
        }

        /* ë©”ì‹œì§€ ì…ë ¥ ì˜ì—­ */
        .chat-input {
            padding: 1rem 1.5rem;
            border-top: 1px solid #e9ecef;
            background: white;
        }

        .input-container {
            display: flex;
            gap: 0.75rem;
            align-items: end;
        }

        .message-input {
            flex: 1;
            min-height: 40px;
            max-height: 120px;
            padding: 0.75rem 1rem;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            resize: none;
            font-family: inherit;
            font-size: 0.9rem;
            line-height: 1.4;
            transition: border-color 0.2s;
        }

        .message-input:focus {
            outline: none;
            border-color: #27ae60;
        }

        .input-actions {
            display: flex;
            gap: 0.5rem;
        }

        .input-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 1rem;
        }

        .emoji-btn {
            background: #f8f9fa;
            color: #666;
        }

        .emoji-btn:hover {
            background: #e9ecef;
        }

        .send-btn {
            background: #27ae60;
            color: white;
        }

        .send-btn:hover {
            background: #2ecc71;
            transform: scale(1.05);
        }

        .send-btn:disabled {
            background: #dee2e6;
            cursor: not-allowed;
            transform: none;
        }

        /* ìš°ì¸¡ íŒ¨ë„ - ì˜¨ë¼ì¸ ì‚¬ìš©ì */
        .users-panel {
            width: 250px;
            background: #fff;
            border-left: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e9ecef;
            background: #f8f9fa;
        }

        .panel-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .online-users {
            flex: 1;
            overflow-y: auto;
        }

        .user-item {
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border-bottom: 1px solid #f8f9fa;
            cursor: pointer;
            transition: background 0.2s;
        }

        .user-item:hover {
            background: #f8f9fa;
        }

        .user-item .user-avatar {
            width: 30px;
            height: 30px;
            font-size: 0.8rem;
        }

        .user-item-info h5 {
            font-size: 0.9rem;
            margin-bottom: 0.2rem;
        }

        .user-item-status {
            font-size: 0.8rem;
            color: #666;
        }

        .typing-indicator {
            padding: 0.75rem 1rem;
            font-style: italic;
            color: #666;
            font-size: 0.9rem;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 0.5rem;
            display: none;
        }

        .typing-indicator.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .typing-dots {
            display: inline-flex;
            gap: 2px;
        }

        .typing-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #666;
            animation: typingDot 1.5s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.3s; }
        .typing-dot:nth-child(3) { animation-delay: 0.6s; }

        @keyframes typingDot {
            0%, 80%, 100% { opacity: 0.3; }
            40% { opacity: 1; }
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .chat-container {
                position: relative;
            }

            .chat-sidebar {
                position: absolute;
                left: -100%;
                z-index: 100;
                height: 100%;
                transition: left 0.3s ease;
            }

            .chat-sidebar.mobile-open {
                left: 0;
            }

            .users-panel {
                display: none;
            }

            .nav-links {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
                background: none;
                border: none;
                font-size: 1.2rem;
                cursor: pointer;
                color: #333;
            }
        }

        .mobile-menu-btn {
            display: none;
        }

        /* ì•Œë¦¼ */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        /* ì›°ì»´ ë©”ì‹œì§€ */
        .welcome-message {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .welcome-message i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <nav>
                <a href="/" class="logo">
                    <i class="fas fa-leaf"></i>
                    PAM-TALK
                </a>

                <ul class="nav-links">
                    <li><a href="/">í”¼ë“œ</a></li>
                    <li><a href="/static/marketplace.html">ì¥í„°</a></li>
                    <li><a href="/static/challenges.html">ì±Œë¦°ì§€</a></li>
                    <li><a href="/static/community.html" class="active">ì»¤ë®¤ë‹ˆí‹°</a></li>
                </ul>

                <div class="user-status">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="user-avatar" title="ê¹€ë†ë¶€ (ì˜¨ë¼ì¸)">
                        ê¹€<div class="online-indicator"></div>
                    </div>
                </div>
            </nav>
        </header>

        <div class="chat-container">
            <!-- ì‚¬ì´ë“œë°” - ì±„íŒ…ë£¸ ëª©ë¡ -->
            <div class="chat-sidebar" id="chatSidebar">
                <div class="sidebar-header">
                    <h3 class="sidebar-title">ğŸ’¬ PAM-TALK ì»¤ë®¤ë‹ˆí‹°</h3>
                    <p class="sidebar-subtitle">ë†ë¶€ì™€ ì†Œë¹„ìê°€ í•¨ê»˜í•˜ëŠ” ì†Œí†µê³µê°„</p>
                </div>

                <div class="room-categories">
                    <!-- ê¸€ë¡œë²Œ ì±„íŒ… -->
                    <div class="category-section">
                        <div class="category-title">ğŸŒ ì „ì²´ ì±„íŒ…</div>
                        <ul class="room-list">
                            <li class="room-item active" data-room="global" onclick="switchRoom('global')">
                                <div class="room-info">
                                    <div class="room-icon global">
                                        <i class="fas fa-globe"></i>
                                    </div>
                                    <div class="room-details">
                                        <h4>ì „ì²´ ì±„íŒ…</h4>
                                        <div class="room-status">ëª¨ë“  ì‚¬ìš©ìì™€ ì†Œí†µ</div>
                                    </div>
                                </div>
                                <div class="room-badges">
                                    <div class="online-count">234</div>
                                    <div class="unread-badge">3</div>
                                </div>
                            </li>
                        </ul>
                    </div>

                    <!-- ì§€ì—­ ì±„íŒ… -->
                    <div class="category-section">
                        <div class="category-title">ğŸ—ºï¸ ì§€ì—­ ì±„íŒ…</div>
                        <ul class="room-list">
                            <li class="room-item" data-room="seoul" onclick="switchRoom('seoul')">
                                <div class="room-info">
                                    <div class="room-icon local">
                                        <i class="fas fa-map-marker-alt"></i>
                                    </div>
                                    <div class="room-details">
                                        <h4>ì„œìš¸ ì§€ì—­</h4>
                                        <div class="room-status">ì„œìš¸ ë†ë¶€Â·ì†Œë¹„ì ëª¨ì„</div>
                                    </div>
                                </div>
                                <div class="room-badges">
                                    <div class="online-count">89</div>
                                </div>
                            </li>
                            <li class="room-item" data-room="gyeonggi" onclick="switchRoom('gyeonggi')">
                                <div class="room-info">
                                    <div class="room-icon local">
                                        <i class="fas fa-seedling"></i>
                                    </div>
                                    <div class="room-details">
                                        <h4>ê²½ê¸°ë„ ì§€ì—­</h4>
                                        <div class="room-status">ê²½ê¸° ë†ì¥ ì§ê±°ë˜ë°©</div>
                                    </div>
                                </div>
                                <div class="room-badges">
                                    <div class="online-count">156</div>
                                    <div class="unread-badge">1</div>
                                </div>
                            </li>
                        </ul>
                    </div>

                    <!-- ê·¸ë£¹ ì±„íŒ… -->
                    <div class="category-section">
                        <div class="category-title">ğŸ‘¥ ê´€ì‹¬ì‚¬ ê·¸ë£¹</div>
                        <ul class="room-list">
                            <li class="room-item" data-room="organic" onclick="switchRoom('organic')">
                                <div class="room-info">
                                    <div class="room-icon group">
                                        <i class="fas fa-leaf"></i>
                                    </div>
                                    <div class="room-details">
                                        <h4>ìœ ê¸°ë† ì• í˜¸ê°€</h4>
                                        <div class="room-status">ìœ ê¸°ë† ì •ë³´ ê³µìœ ë°©</div>
                                    </div>
                                </div>
                                <div class="room-badges">
                                    <div class="online-count">67</div>
                                </div>
                            </li>
                            <li class="room-item" data-room="challenges" onclick="switchRoom('challenges')">
                                <div class="room-info">
                                    <div class="room-icon group">
                                        <i class="fas fa-trophy"></i>
                                    </div>
                                    <div class="room-details">
                                        <h4>íƒ„ì†Œ ì±Œë¦°ì§€</h4>
                                        <div class="room-status">í™˜ê²½ ì±Œë¦°ì§€ ì°¸ê°€ì</div>
                                    </div>
                                </div>
                                <div class="room-badges">
                                    <div class="online-count">143</div>
                                    <div class="unread-badge">5</div>
                                </div>
                            </li>
                            <li class="room-item" data-room="recipes" onclick="switchRoom('recipes')">
                                <div class="room-info">
                                    <div class="room-icon group">
                                        <i class="fas fa-utensils"></i>
                                    </div>
                                    <div class="room-details">
                                        <h4>ë ˆì‹œí”¼ ê³µìœ </h4>
                                        <div class="room-status">ìš”ë¦¬ë²• & íŒ ê³µìœ </div>
                                    </div>
                                </div>
                                <div class="room-badges">
                                    <div class="online-count">92</div>
                                </div>
                            </li>
                        </ul>
                    </div>

                    <!-- ê³µì§€ì‚¬í•­ -->
                    <div class="category-section">
                        <div class="category-title">ğŸ“¢ ê³µì§€ì‚¬í•­</div>
                        <ul class="room-list">
                            <li class="room-item" data-room="announcements" onclick="switchRoom('announcements')">
                                <div class="room-info">
                                    <div class="room-icon announce">
                                        <i class="fas fa-bullhorn"></i>
                                    </div>
                                    <div class="room-details">
                                        <h4>í”Œë«í¼ ê³µì§€</h4>
                                        <div class="room-status">ì¤‘ìš” ì•Œë¦¼ ë° ì—…ë°ì´íŠ¸</div>
                                    </div>
                                </div>
                                <div class="room-badges">
                                    <div class="unread-badge">2</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- ë©”ì¸ ì±„íŒ… ì˜ì—­ -->
            <div class="chat-main">
                <div class="chat-header">
                    <div class="chat-title">
                        <div class="room-icon global">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div>
                            <h2 id="currentRoomTitle">ì „ì²´ ì±„íŒ…</h2>
                            <div class="chat-description" id="currentRoomDesc">ëª¨ë“  PAM-TALK ì‚¬ìš©ìì™€ ììœ ë¡­ê²Œ ì†Œí†µí•˜ì„¸ìš”</div>
                        </div>
                    </div>
                    <div class="chat-actions">
                        <button class="chat-action-btn">
                            <i class="fas fa-search"></i> ê²€ìƒ‰
                        </button>
                        <button class="chat-action-btn">
                            <i class="fas fa-cog"></i> ì„¤ì •
                        </button>
                    </div>
                </div>

                <div class="typing-indicator" id="typingIndicator">
                    <span id="typingUser">ê¹€ë†ë¶€ë‹˜</span>ì´ ì…ë ¥ ì¤‘ì…ë‹ˆë‹¤
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <!-- ë©”ì‹œì§€ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    <div class="welcome-message" id="welcomeMessage">
                        <i class="fas fa-comments"></i>
                        <h3>PAM-TALK ì»¤ë®¤ë‹ˆí‹°ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h3>
                        <p>ë†ë¶€ì™€ ì†Œë¹„ìê°€ í•¨ê»˜í•˜ëŠ” ë”°ëœ»í•œ ì†Œí†µê³µê°„ì…ë‹ˆë‹¤.<br>
                        ì²« ë©”ì‹œì§€ë¥¼ ë³´ë‚´ì„œ ëŒ€í™”ì— ì°¸ì—¬í•´ë³´ì„¸ìš”! ğŸŒ±</p>
                    </div>
                </div>

                <div class="chat-input">
                    <div class="input-container">
                        <textarea
                            id="messageInput"
                            class="message-input"
                            placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                            rows="1"
                            onkeydown="handleInputKeydown(event)"
                            oninput="handleInput()"
                        ></textarea>
                        <div class="input-actions">
                            <button class="input-btn emoji-btn" onclick="toggleEmojiPicker()" title="ì´ëª¨ì§€">
                                <i class="fas fa-smile"></i>
                            </button>
                            <button class="input-btn send-btn" id="sendButton" onclick="sendMessage()" title="ì „ì†¡" disabled>
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìš°ì¸¡ íŒ¨ë„ - ì˜¨ë¼ì¸ ì‚¬ìš©ì -->
            <div class="users-panel" id="usersPanel">
                <div class="panel-header">
                    <h4 class="panel-title">ì˜¨ë¼ì¸ ì‚¬ìš©ì</h4>
                    <p style="font-size: 0.8rem; color: #666;">ì´ <span id="onlineCount">234</span>ëª…</p>
                </div>
                <div class="online-users" id="onlineUsers">
                    <!-- ì˜¨ë¼ì¸ ì‚¬ìš©ì ëª©ë¡ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentRoom = 'global';
        let currentUser = {
            id: 'user_demo',
            name: 'ê¹€ë†ë¶€',
            type: 'farmer',
            avatar: 'ê¹€'
        };
        let messages = {};
        let onlineUsers = [];
        let isTyping = false;
        let typingTimeout;
        let messagePolling;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            initializeChat();
            loadDemoData();
            startMessagePolling();
        });

        // ì±„íŒ… ì´ˆê¸°í™”
        function initializeChat() {
            // ë©”ì‹œì§€ ì…ë ¥ì°½ ìë™ ì¡°ì ˆ
            const messageInput = document.getElementById('messageInput');
            messageInput.addEventListener('input', (e) => {
                e.target.style.height = 'auto';
                e.target.style.height = Math.min(e.target.scrollHeight, 120) + 'px';
            });

            // ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.addEventListener('scroll', handleChatScroll);
        }

        // ë°ëª¨ ë°ì´í„° ë¡œë“œ
        function loadDemoData() {
            // ë°ëª¨ ë©”ì‹œì§€ ìƒì„±
            messages = {
                'global': [
                    {
                        id: 'msg1',
                        user_id: 'farmer001',
                        username: 'ë°•ë†ë¶€',
                        user_type: 'farmer',
                        content: 'ì•ˆë…•í•˜ì„¸ìš”! ì˜¤ëŠ˜ ì•„ì¹¨ì— ìˆ˜í™•í•œ í† ë§ˆí† ê°€ ì •ë§ ë§›ìˆê²Œ ìµì—ˆì–´ìš” ğŸ…',
                        timestamp: new Date(Date.now() - 300000).toISOString(),
                        eco_points: 5
                    },
                    {
                        id: 'msg2',
                        user_id: 'consumer001',
                        username: 'ì´ì†Œë¹„ì',
                        user_type: 'consumer',
                        content: 'ì™€! í† ë§ˆí†  ì‚¬ì§„ ë³´ë‹ˆ ë„ˆë¬´ ë§›ìˆì–´ë³´ì—¬ìš”. ì£¼ë¬¸ ê°€ëŠ¥í•œê°€ìš”?',
                        timestamp: new Date(Date.now() - 240000).toISOString()
                    },
                    {
                        id: 'msg3',
                        user_id: 'farmer001',
                        username: 'ë°•ë†ë¶€',
                        user_type: 'farmer',
                        content: 'ë„¤! 1kgì— 3,500ì›ì´ì—ìš”. ì§ì ‘ ë†ì¥ì—ì„œ ê°€ì ¸ê°€ì‹œë©´ 500ì› í• ì¸í•´ë“œë ¤ìš”!',
                        timestamp: new Date(Date.now() - 180000).toISOString()
                    },
                    {
                        id: 'msg4',
                        user_id: 'restaurant001',
                        username: 'ë§›ì§‘ì‚¬ì¥',
                        user_type: 'restaurant',
                        content: 'ì €í¬ ë ˆìŠ¤í† ë‘ì—ì„œë„ í† ë§ˆí† ê°€ í•„ìš”í•œë°, ëŒ€ëŸ‰ ì£¼ë¬¸ í• ì¸ì´ ìˆë‚˜ìš”?',
                        timestamp: new Date(Date.now() - 120000).toISOString()
                    }
                ],
                'seoul': [],
                'gyeonggi': [
                    {
                        id: 'msg5',
                        user_id: 'farmer002',
                        username: 'ìš©ì¸ë†ë¶€',
                        user_type: 'farmer',
                        content: 'ê²½ê¸°ë„ ìš©ì¸ì—ì„œ ìœ ê¸°ë† ë°°ì¶” ë†ì‚¬ì§“ê³  ìˆìŠµë‹ˆë‹¤! ê¹€ì¥ì² ì´ë¼ ë°”ì˜ë„¤ìš” ğŸ˜…',
                        timestamp: new Date(Date.now() - 60000).toISOString()
                    }
                ],
                'organic': [],
                'challenges': [
                    {
                        id: 'msg6',
                        user_id: 'eco_warrior',
                        username: 'í™˜ê²½ì§€í‚´ì´',
                        user_type: 'consumer',
                        content: 'ë¡œì»¬í‘¸ë“œ ì±Œë¦°ì§€ 15ì¼ì§¸! ì˜¤ëŠ˜ë„ 30km ì´ë‚´ ë†ì‚°ë¬¼ë¡œ ì¥ë³´ê¸° ì„±ê³µ! ğŸ’ª',
                        timestamp: new Date(Date.now() - 30000).toISOString(),
                        eco_points: 10,
                        is_eco_message: true
                    }
                ],
                'recipes': [],
                'announcements': [
                    {
                        id: 'announce1',
                        user_id: 'admin',
                        username: 'PAM-TALK ìš´ì˜ì§„',
                        user_type: 'admin',
                        content: 'ğŸ‰ ìƒˆë¡œìš´ íƒ„ì†Œ ì±Œë¦°ì§€ "ì œë¡œì›¨ì´ìŠ¤íŠ¸ ìš”ë¦¬" ê°€ ì¶œì‹œë˜ì—ˆìŠµë‹ˆë‹¤! ë§ì€ ì°¸ì—¬ ë¶€íƒë“œë ¤ìš”.',
                        timestamp: new Date(Date.now() - 3600000).toISOString(),
                        is_announcement: true
                    }
                ]
            };

            // ì˜¨ë¼ì¸ ì‚¬ìš©ì ìƒì„±
            onlineUsers = [
                { id: 'farmer001', name: 'ë°•ë†ë¶€', type: 'farmer', avatar: 'ë°•', status: 'ë†ì¥ì—ì„œ' },
                { id: 'consumer001', name: 'ì´ì†Œë¹„ì', type: 'consumer', avatar: 'ì´', status: 'ì¥ë³´ëŠ” ì¤‘' },
                { id: 'restaurant001', name: 'ë§›ì§‘ì‚¬ì¥', type: 'restaurant', avatar: 'ë§›', status: 'ìš”ë¦¬ ì¤‘' },
                { id: 'farmer002', name: 'ìš©ì¸ë†ë¶€', type: 'farmer', avatar: 'ìš©', status: 'ìˆ˜í™• ì¤‘' },
                { id: 'eco_warrior', name: 'í™˜ê²½ì§€í‚´ì´', type: 'consumer', avatar: 'í™˜', status: 'ì±Œë¦°ì§€ ì°¸ì—¬ ì¤‘' },
                { id: 'organic_lover', name: 'ìœ ê¸°ë†ëŸ¬ë²„', type: 'consumer', avatar: 'ìœ ', status: 'ì˜¨ë¼ì¸' },
            ];

            // UI ì—…ë°ì´íŠ¸
            renderMessages();
            renderOnlineUsers();
        }

        // ì±„íŒ…ë°© ì „í™˜
        function switchRoom(roomId) {
            // ì´ì „ ë°© ë¹„í™œì„±í™”
            document.querySelectorAll('.room-item').forEach(item => {
                item.classList.remove('active');
            });

            // ìƒˆ ë°© í™œì„±í™”
            document.querySelector(`.room-item[data-room="${roomId}"]`).classList.add('active');

            currentRoom = roomId;
            renderMessages();
            updateRoomHeader();

            // ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ë°°ì§€ ì œê±°
            const unreadBadge = document.querySelector(`.room-item[data-room="${roomId}"] .unread-badge`);
            if (unreadBadge) {
                unreadBadge.remove();
            }

            // ëª¨ë°”ì¼ì—ì„œ ì‚¬ì´ë“œë°” ë‹«ê¸°
            if (window.innerWidth <= 768) {
                toggleSidebar();
            }
        }

        // ì±„íŒ…ë°© í—¤ë” ì—…ë°ì´íŠ¸
        function updateRoomHeader() {
            const roomInfo = {
                'global': { title: 'ì „ì²´ ì±„íŒ…', desc: 'ëª¨ë“  PAM-TALK ì‚¬ìš©ìì™€ ììœ ë¡­ê²Œ ì†Œí†µí•˜ì„¸ìš”', icon: 'fas fa-globe' },
                'seoul': { title: 'ì„œìš¸ ì§€ì—­', desc: 'ì„œìš¸ ë†ë¶€Â·ì†Œë¹„ì ëª¨ì„', icon: 'fas fa-map-marker-alt' },
                'gyeonggi': { title: 'ê²½ê¸°ë„ ì§€ì—­', desc: 'ê²½ê¸° ë†ì¥ ì§ê±°ë˜ë°©', icon: 'fas fa-seedling' },
                'organic': { title: 'ìœ ê¸°ë† ì• í˜¸ê°€', desc: 'ìœ ê¸°ë† ì •ë³´ ê³µìœ ë°©', icon: 'fas fa-leaf' },
                'challenges': { title: 'íƒ„ì†Œ ì±Œë¦°ì§€', desc: 'í™˜ê²½ ì±Œë¦°ì§€ ì°¸ê°€ìë“¤ì˜ ì†Œí†µê³µê°„', icon: 'fas fa-trophy' },
                'recipes': { title: 'ë ˆì‹œí”¼ ê³µìœ ', desc: 'ë§›ìˆëŠ” ìš”ë¦¬ë²•ê³¼ íŒì„ ë‚˜ëˆ„ì–´ìš”', icon: 'fas fa-utensils' },
                'announcements': { title: 'í”Œë«í¼ ê³µì§€', desc: 'ì¤‘ìš” ì•Œë¦¼ ë° ì—…ë°ì´íŠ¸', icon: 'fas fa-bullhorn' }
            };

            const info = roomInfo[currentRoom];
            document.getElementById('currentRoomTitle').textContent = info.title;
            document.getElementById('currentRoomDesc').textContent = info.desc;

            const roomIcon = document.querySelector('.chat-header .room-icon i');
            roomIcon.className = info.icon;
        }

        // ë©”ì‹œì§€ ë Œë”ë§
        function renderMessages() {
            const chatMessages = document.getElementById('chatMessages');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const roomMessages = messages[currentRoom] || [];

            if (roomMessages.length === 0) {
                welcomeMessage.style.display = 'block';
                return;
            } else {
                welcomeMessage.style.display = 'none';
            }

            chatMessages.innerHTML = '';

            roomMessages.forEach(message => {
                const messageElement = createMessageElement(message);
                chatMessages.appendChild(messageElement);
            });

            // ìŠ¤í¬ë¡¤ì„ ìµœí•˜ë‹¨ìœ¼ë¡œ
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // ë©”ì‹œì§€ ìš”ì†Œ ìƒì„±
        function createMessageElement(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${message.user_id === currentUser.id ? 'own' : ''}`;

            const isEcoMessage = message.is_eco_message || message.eco_points > 0;
            const isAnnouncement = message.is_announcement;

            const userTypeClass = message.user_type || 'consumer';
            const userTypeLabel = {
                'farmer': 'ğŸŒ¾ ë†ë¶€',
                'consumer': 'ğŸ  ì†Œë¹„ì',
                'restaurant': 'ğŸ½ï¸ ë ˆìŠ¤í† ë‘',
                'admin': 'âš¡ ìš´ì˜ì§„'
            }[userTypeClass] || 'ğŸ‘¤ ì‚¬ìš©ì';

            messageDiv.innerHTML = `
                <div class="message-avatar">${message.username ? message.username.charAt(0) : 'U'}</div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-author">${message.username}</span>
                        <span class="user-type ${userTypeClass}">${userTypeLabel}</span>
                        <span class="message-time">${formatTime(message.timestamp)}</span>
                    </div>
                    <div class="message-bubble ${isEcoMessage ? 'eco-message' : ''} ${isAnnouncement ? 'announcement' : ''}">
                        ${message.content}
                        ${message.eco_points ? `<div class="eco-points">+${message.eco_points} ì—ì½”í¬ì¸íŠ¸ íšë“!</div>` : ''}
                    </div>
                </div>
            `;

            return messageDiv;
        }

        // ì˜¨ë¼ì¸ ì‚¬ìš©ì ë Œë”ë§
        function renderOnlineUsers() {
            const onlineUsersContainer = document.getElementById('onlineUsers');
            const onlineCount = document.getElementById('onlineCount');

            onlineCount.textContent = onlineUsers.length + 1; // +1 for current user

            onlineUsersContainer.innerHTML = onlineUsers.map(user => `
                <div class="user-item" onclick="startDirectMessage('${user.id}')">
                    <div class="user-avatar">${user.avatar}</div>
                    <div class="user-item-info">
                        <h5>${user.name}</h5>
                        <div class="user-item-status">${user.status}</div>
                    </div>
                </div>
            `).join('');
        }

        // ë©”ì‹œì§€ ì „ì†¡
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const content = messageInput.value.trim();

            if (!content) return;

            const newMessage = {
                id: 'msg_' + Date.now(),
                user_id: currentUser.id,
                username: currentUser.name,
                user_type: currentUser.type,
                content: content,
                timestamp: new Date().toISOString()
            };

            // ì—ì½” í‚¤ì›Œë“œ ê°ì§€
            const ecoKeywords = ['ì±Œë¦°ì§€', 'í™˜ê²½', 'íƒ„ì†Œ', 'ì—ì½”', 'ì¹œí™˜ê²½', 'ìœ ê¸°ë†', 'ë¡œì»¬'];
            if (ecoKeywords.some(keyword => content.includes(keyword))) {
                newMessage.eco_points = 5;
                newMessage.is_eco_message = true;
            }

            // ë©”ì‹œì§€ ì¶”ê°€
            if (!messages[currentRoom]) {
                messages[currentRoom] = [];
            }
            messages[currentRoom].push(newMessage);

            // UI ì—…ë°ì´íŠ¸
            const chatMessages = document.getElementById('chatMessages');
            const messageElement = createMessageElement(newMessage);
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // ì…ë ¥ì°½ ì´ˆê¸°í™”
            messageInput.value = '';
            messageInput.style.height = 'auto';
            document.getElementById('sendButton').disabled = true;

            // ì—ì½” í¬ì¸íŠ¸ ì•Œë¦¼
            if (newMessage.eco_points) {
                showNotification(`í™˜ê²½ ê´€ë ¨ ë©”ì‹œì§€ë¡œ +${newMessage.eco_points} ì—ì½”í¬ì¸íŠ¸ íšë“! ğŸŒ±`);
            }

            // ì›°ì»´ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
            document.getElementById('welcomeMessage').style.display = 'none';
        }

        // ì…ë ¥ ì²˜ë¦¬
        function handleInput() {
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');

            sendButton.disabled = !messageInput.value.trim();

            // íƒ€ì´í•‘ í‘œì‹œ
            if (!isTyping) {
                isTyping = true;
                showTypingIndicator();
            }

            clearTimeout(typingTimeout);
            typingTimeout = setTimeout(() => {
                isTyping = false;
                hideTypingIndicator();
            }, 1000);
        }

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        function handleInputKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // íƒ€ì´í•‘ í‘œì‹œ
        function showTypingIndicator() {
            // ë°ëª¨ìš© - ì‹¤ì œë¡œëŠ” ë‹¤ë¥¸ ì‚¬ìš©ìì˜ íƒ€ì´í•‘ì„ í‘œì‹œ
            if (Math.random() > 0.7) {
                const indicator = document.getElementById('typingIndicator');
                const randomUser = onlineUsers[Math.floor(Math.random() * onlineUsers.length)];
                document.getElementById('typingUser').textContent = randomUser.name + 'ë‹˜';
                indicator.classList.add('show');

                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 2000);
            }
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').classList.remove('show');
        }

        // ë©”ì‹œì§€ í´ë§ ì‹œì‘
        function startMessagePolling() {
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì„œë²„ì—ì„œ ìƒˆ ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜´
            messagePolling = setInterval(() => {
                // ë°ëª¨: ëœë¤í•˜ê²Œ ìƒˆ ë©”ì‹œì§€ ìƒì„±
                if (Math.random() > 0.95) {
                    generateRandomMessage();
                }
            }, 3000);
        }

        // ëœë¤ ë©”ì‹œì§€ ìƒì„± (ë°ëª¨ìš©)
        function generateRandomMessage() {
            const rooms = ['global', 'gyeonggi', 'challenges'];
            const randomRoom = rooms[Math.floor(Math.random() * rooms.length)];
            const randomUser = onlineUsers[Math.floor(Math.random() * onlineUsers.length)];

            const demoMessages = [
                'ì˜¤ëŠ˜ ë‚ ì”¨ê°€ ì •ë§ ì¢‹ë„¤ìš”! ë†ì¥ ì¼í•˜ê¸° ë”± ì¢‹ì€ ë‚ ì´ì—ìš” â˜€ï¸',
                'ë°©ê¸ˆ ë°°ì†¡ë°›ì€ í† ë§ˆí†  ì •ë§ ì‹ ì„ í•˜ë„¤ìš”! ê°ì‚¬í•©ë‹ˆë‹¤ ğŸ…',
                'ì´ë²ˆ ì£¼ ë¡œì»¬í‘¸ë“œ ì±Œë¦°ì§€ ì„±ê³µ! íƒ„ì†Œë°œìêµ­ -5kg ë‹¬ì„±í–ˆì–´ìš”!',
                'ìœ ê¸°ë† ë‹¹ê·¼ ì •ë§ ë‹¬ì•„ìš”! ì•„ì´ë“¤ì´ ë„ˆë¬´ ì¢‹ì•„í•´ìš” ğŸ¥•',
                'ë†ì¥ ì²´í—˜ í”„ë¡œê·¸ë¨ ì–¸ì œ ì‹œì‘í•˜ë‚˜ìš”?',
                'ì œì²  ìŒì‹ ë ˆì‹œí”¼ ê³µìœ í•´ì£¼ì„¸ìš”!',
                'ì¹œí™˜ê²½ í¬ì¥ì¬ ì‚¬ìš©í•´ì£¼ì…”ì„œ ê°ì‚¬í•´ìš” â™»ï¸'
            ];

            const newMessage = {
                id: 'msg_' + Date.now() + '_auto',
                user_id: randomUser.id,
                username: randomUser.name,
                user_type: randomUser.type,
                content: demoMessages[Math.floor(Math.random() * demoMessages.length)],
                timestamp: new Date().toISOString()
            };

            // ì—ì½” ë©”ì‹œì§€ í™•ë¥ 
            if (Math.random() > 0.7) {
                newMessage.eco_points = Math.floor(Math.random() * 10) + 1;
                newMessage.is_eco_message = true;
            }

            if (!messages[randomRoom]) {
                messages[randomRoom] = [];
            }
            messages[randomRoom].push(newMessage);

            // í˜„ì¬ ë°©ì´ë©´ UI ì—…ë°ì´íŠ¸
            if (randomRoom === currentRoom) {
                const chatMessages = document.getElementById('chatMessages');
                const messageElement = createMessageElement(newMessage);
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // ì›°ì»´ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
                document.getElementById('welcomeMessage').style.display = 'none';
            } else {
                // ë‹¤ë¥¸ ë°©ì— ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ë°°ì§€ ì¶”ê°€
                const roomItem = document.querySelector(`.room-item[data-room="${randomRoom}"]`);
                if (roomItem) {
                    let unreadBadge = roomItem.querySelector('.unread-badge');
                    if (!unreadBadge) {
                        unreadBadge = document.createElement('div');
                        unreadBadge.className = 'unread-badge';
                        unreadBadge.textContent = '1';
                        roomItem.querySelector('.room-badges').appendChild(unreadBadge);
                    } else {
                        unreadBadge.textContent = parseInt(unreadBadge.textContent) + 1;
                    }
                }
            }
        }

        // ì§ì ‘ ë©”ì‹œì§€ ì‹œì‘
        function startDirectMessage(userId) {
            const user = onlineUsers.find(u => u.id === userId);
            if (user) {
                alert(`${user.name}ë‹˜ê³¼ì˜ 1:1 ì±„íŒ…ì„ ì‹œì‘í•©ë‹ˆë‹¤!

1:1 ì±„íŒ… ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤. ğŸš§`);
            }
        }

        // ì´ëª¨ì§€ í”¼ì»¤ í† ê¸€
        function toggleEmojiPicker() {
            const commonEmojis = ['ğŸ˜Š', 'ğŸ‘', 'â¤ï¸', 'ğŸ˜‚', 'ğŸ‰', 'ğŸ‘', 'ğŸ™', 'ğŸ’ª', 'ğŸŒ±', 'ğŸ…', 'ğŸ¥•', 'ğŸŒ½', 'ğŸ', 'ğŸŒ¾', 'â™»ï¸'];
            const emoji = commonEmojis[Math.floor(Math.random() * commonEmojis.length)];

            const messageInput = document.getElementById('messageInput');
            messageInput.value += emoji;
            handleInput();
            messageInput.focus();
        }

        // ì±„íŒ… ìŠ¤í¬ë¡¤ ì²˜ë¦¬
        function handleChatScroll() {
            // ìŠ¤í¬ë¡¤ ìµœìƒë‹¨ ë„ë‹¬ ì‹œ ì´ì „ ë©”ì‹œì§€ ë¡œë“œ (ì‹¤ì œ êµ¬í˜„ì—ì„œ)
        }

        // ëª¨ë°”ì¼ ì‚¬ì´ë“œë°” í† ê¸€
        function toggleSidebar() {
            const sidebar = document.getElementById('chatSidebar');
            sidebar.classList.toggle('mobile-open');
        }

        // ì‹œê°„ í¬ë§·íŒ…
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;

            if (diff < 60000) return 'ë°©ê¸ˆ ì „';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}ë¶„ ì „`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}ì‹œê°„ ì „`;
            return date.toLocaleDateString('ko-KR');
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ í´ë§ ì •ë¦¬
        window.addEventListener('beforeunload', () => {
            if (messagePolling) {
                clearInterval(messagePolling);
            }
        });
    </script>
</body>
</html>