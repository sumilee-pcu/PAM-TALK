<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>탄소 챌린지 | PAM-TALK</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* 헤더 */
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 2rem;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #27ae60;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: #333;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            position: relative;
        }

        .nav-links a:hover {
            color: #27ae60;
        }

        .nav-links a.active {
            color: #27ae60;
            font-weight: 600;
        }

        .nav-links a.active::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 100%;
            height: 2px;
            background: #27ae60;
        }

        /* 메인 콘텐츠 */
        main {
            margin-top: 80px;
            padding: 2rem 0;
        }

        /* 히어로 섹션 */
        .hero {
            color: white;
            padding: 4rem 0;
            text-align: center;
            margin-bottom: 2rem;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .hero .subtitle {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .hero-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .hero-stat {
            background: rgba(255,255,255,0.1);
            padding: 2rem;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .hero-stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .hero-stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* 대시보드 섹션 */
        .dashboard {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 3rem;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .dashboard-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #333;
        }

        .user-level {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .carbon-tracker {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .carbon-meter {
            text-align: center;
        }

        .carbon-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(#27ae60 70%, #e8f5e8 70%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            position: relative;
        }

        .carbon-inner {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .carbon-value {
            font-size: 2rem;
            font-weight: bold;
            color: #27ae60;
        }

        .carbon-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .progress-stat {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .progress-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 0.3rem;
        }

        .progress-stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        /* 활성 챌린지 섹션 */
        .active-challenges {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 3rem;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 2rem;
            color: #333;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .challenges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
        }

        .challenge-card {
            background: linear-gradient(135deg, #f8f9fa, #fff);
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 2rem;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .challenge-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-color: #27ae60;
        }

        .challenge-status {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: #27ae60;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .challenge-status.completed {
            background: #28a745;
        }

        .challenge-status.new {
            background: #007bff;
        }

        .challenge-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin-bottom: 1rem;
        }

        .challenge-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .challenge-desc {
            color: #666;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .challenge-progress {
            margin-bottom: 1rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            transition: width 0.3s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
        }

        .challenge-reward {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 0.8rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .challenge-participants {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .participant-avatars {
            display: flex;
            margin-left: 0.5rem;
        }

        .participant-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            border: 2px solid white;
            margin-left: -8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: white;
            font-weight: bold;
        }

        .challenge-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .btn-outline {
            background: transparent;
            color: #27ae60;
            border: 2px solid #27ae60;
        }

        .btn-outline:hover {
            background: #27ae60;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-disabled {
            background: #6c757d;
            color: white;
            cursor: not-allowed;
        }

        /* 리더보드 섹션 */
        .leaderboard {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 3rem;
        }

        .leaderboard-list {
            list-style: none;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #eee;
            transition: background 0.3s;
        }

        .leaderboard-item:hover {
            background: #f8f9fa;
        }

        .leaderboard-rank {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 1rem;
        }

        .leaderboard-rank.gold {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
        }

        .leaderboard-rank.silver {
            background: linear-gradient(45deg, #c0c0c0, #e5e5e5);
            color: #333;
        }

        .leaderboard-rank.bronze {
            background: linear-gradient(45deg, #cd7f32, #daa520);
            color: white;
        }

        .leaderboard-rank.other {
            background: #f8f9fa;
            color: #666;
        }

        .leaderboard-user {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .user-info h4 {
            margin-bottom: 0.2rem;
        }

        .user-info .user-level {
            font-size: 0.8rem;
            background: none;
            color: #666;
            padding: 0;
        }

        .leaderboard-score {
            text-align: right;
        }

        .score-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #27ae60;
        }

        .score-label {
            font-size: 0.8rem;
            color: #666;
        }

        /* 새 챌린지 생성 */
        .create-challenge {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 3rem;
        }

        .create-challenge h3 {
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .create-challenge p {
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .hero-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .carbon-tracker {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .progress-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .challenges-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-header {
                flex-direction: column;
                align-items: start;
                gap: 1rem;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .nav-links {
                display: none;
            }
        }

        /* 애니메이션 */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        .challenge-icon:hover {
            animation: bounce 1s;
        }

        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <header>
        <nav class="container">
            <a href="/" class="logo">
                <i class="fas fa-leaf"></i>
                PAM-TALK
            </a>

            <ul class="nav-links">
                <li><a href="/">피드</a></li>
                <li><a href="/static/marketplace.html">장터</a></li>
                <li><a href="/static/challenges.html" class="active">챌린지</a></li>
                <li><a href="#community">커뮤니티</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="hero">
            <div class="container">
                <h1>🌍 탄소 챌린지</h1>
                <p class="subtitle">개인별 탄소발자국 줄이기 도전! 지구를 구하고 리워드도 받으세요</p>

                <div class="hero-stats" id="heroStats">
                    <div class="hero-stat">
                        <div class="hero-stat-value">-2,847kg</div>
                        <div class="hero-stat-label">누적 CO₂ 절약</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-value">1,234</div>
                        <div class="hero-stat-label">참여자 수</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-value">15</div>
                        <div class="hero-stat-label">진행중 챌린지</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-value">89%</div>
                        <div class="hero-stat-label">성공률</div>
                    </div>
                </div>
            </div>
        </section>

        <div class="container">
            <!-- 개인 대시보드 -->
            <section class="dashboard">
                <div class="dashboard-header">
                    <h2 class="dashboard-title">
                        <i class="fas fa-user-circle"></i>
                        내 탄소발자국 대시보드
                    </h2>
                    <div class="user-level">
                        <i class="fas fa-medal"></i>
                        에코 워리어 (레벨 7)
                    </div>
                </div>

                <div class="carbon-tracker">
                    <div class="carbon-meter">
                        <div class="carbon-circle">
                            <div class="carbon-inner">
                                <div class="carbon-value" id="carbonValue">-12.5</div>
                                <div class="carbon-label">kg CO₂</div>
                            </div>
                        </div>
                        <p>이번 달 절약량</p>
                    </div>

                    <div class="progress-stats">
                        <div class="progress-stat">
                            <div class="progress-stat-value">890</div>
                            <div class="progress-stat-label">에코 포인트</div>
                        </div>
                        <div class="progress-stat">
                            <div class="progress-stat-value">7</div>
                            <div class="progress-stat-label">완료한 챌린지</div>
                        </div>
                        <div class="progress-stat">
                            <div class="progress-stat-value">3</div>
                            <div class="progress-stat-label">진행중 챌린지</div>
                        </div>
                        <div class="progress-stat">
                            <div class="progress-stat-value">35km</div>
                            <div class="progress-stat-label">평균 로컬 거리</div>
                        </div>
                        <div class="progress-stat">
                            <div class="progress-stat-value">15일</div>
                            <div class="progress-stat-label">연속 참여</div>
                        </div>
                        <div class="progress-stat">
                            <div class="progress-stat-value">234</div>
                            <div class="progress-stat-label">팔로워</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 활성 챌린지 -->
            <section class="active-challenges">
                <h2 class="section-title">
                    <i class="fas fa-fire"></i>
                    활성 챌린지
                </h2>

                <div class="challenges-grid" id="challengesGrid">
                    <!-- 챌린지 로딩 중 -->
                    <div style="text-align: center; padding: 3rem; grid-column: 1/-1;">
                        <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #27ae60; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                        <p>챌린지를 불러오는 중...</p>
                    </div>
                </div>
            </section>

            <!-- 리더보드 -->
            <section class="leaderboard">
                <h2 class="section-title">
                    <i class="fas fa-trophy"></i>
                    이번 달 리더보드
                </h2>

                <ul class="leaderboard-list" id="leaderboardList">
                    <!-- 리더보드 로딩 중 -->
                </ul>
            </section>

            <!-- 새 챌린지 생성 -->
            <section class="create-challenge">
                <h3>
                    <i class="fas fa-plus-circle"></i>
                    나만의 챌린지 만들기
                </h3>
                <p>커뮤니티와 함께할 새로운 환경 챌린지를 제안해보세요!</p>
                <button class="btn btn-primary" onclick="createChallenge()">
                    <i class="fas fa-lightbulb"></i>
                    챌린지 제안하기
                </button>
            </section>
        </div>
    </main>

    <script>
        // API 엔드포인트
        const API_BASE = 'http://localhost:5003/api';

        // 개인 데이터 (데모)
        let userData = {
            level: 7,
            levelName: '에코 워리어',
            carbonSaved: -12.5,
            ecoPoints: 890,
            completedChallenges: 7,
            activeChallenges: 3,
            averageDistance: 35,
            streakDays: 15,
            followers: 234
        };

        // 페이지 로드 시 실행
        document.addEventListener('DOMContentLoaded', async () => {
            await loadChallenges();
            await loadLeaderboard();
            updateHeroStats();
        });

        // 챌린지 목록 로드
        async function loadChallenges() {
            try {
                const response = await fetch(`${API_BASE}/carbon/challenges`);
                const data = await response.json();

                if (data.success && data.challenges) {
                    renderChallenges(data.challenges);
                } else {
                    // 데모 데이터 사용
                    const demoChallenges = generateDemoChallenges();
                    renderChallenges(demoChallenges);
                }
            } catch (error) {
                console.error('챌린지 로드 실패:', error);
                const demoChallenges = generateDemoChallenges();
                renderChallenges(demoChallenges);
            }
        }

        // 데모 챌린지 데이터 생성
        function generateDemoChallenges() {
            return [
                {
                    challenge_id: 'local_food_30',
                    title: '로컬푸드 30일 챌린지',
                    description: '한 달간 50km 이내 농산물만 구매하기! 운송으로 인한 탄소배출을 줄여보세요.',
                    target_reduction: 15.0,
                    duration_days: 30,
                    reward_points: 500,
                    participants: 156,
                    status: 'active',
                    progress: 73,
                    user_joined: true,
                    difficulty: 'medium',
                    category: '로컬푸드'
                },
                {
                    challenge_id: 'zero_waste_cooking',
                    title: '제로웨이스트 요리 도전',
                    description: '음식 쓰레기 없는 요리로 환경을 보호하고 창의적인 레시피를 개발해보세요.',
                    target_reduction: 8.0,
                    duration_days: 14,
                    reward_points: 300,
                    participants: 89,
                    status: 'active',
                    progress: 45,
                    user_joined: true,
                    difficulty: 'easy',
                    category: '제로웨이스트'
                },
                {
                    challenge_id: 'organic_month',
                    title: '유기농 한 달 생활',
                    description: '유기농 인증 제품만 구매하여 화학 농약 사용을 줄이고 토양을 보호해요.',
                    target_reduction: 12.0,
                    duration_days: 30,
                    reward_points: 450,
                    participants: 203,
                    status: 'active',
                    progress: 0,
                    user_joined: false,
                    difficulty: 'hard',
                    category: '유기농'
                },
                {
                    challenge_id: 'plant_based_week',
                    title: '식물성 식단 일주일',
                    description: '일주일간 식물성 식품만 섭취하여 축산업으로 인한 탄소배출을 줄여봅시다.',
                    target_reduction: 20.0,
                    duration_days: 7,
                    reward_points: 200,
                    participants: 67,
                    status: 'active',
                    progress: 100,
                    user_joined: true,
                    difficulty: 'medium',
                    category: '식단관리'
                },
                {
                    challenge_id: 'season_eating',
                    title: '제철 음식 먹기 챌린지',
                    description: '제철 농산물만 구매하여 에너지 소비를 줄이고 자연의 리듬에 맞춘 식생활을 실천해요.',
                    target_reduction: 6.0,
                    duration_days: 21,
                    reward_points: 350,
                    participants: 124,
                    status: 'active',
                    progress: 0,
                    user_joined: false,
                    difficulty: 'easy',
                    category: '제철음식'
                },
                {
                    challenge_id: 'bike_delivery',
                    title: '자전거 배송 선택하기',
                    description: '농산물 주문 시 자전거 배송을 선택하여 배송 차량의 탄소배출을 줄여보세요.',
                    target_reduction: 4.5,
                    duration_days: 14,
                    reward_points: 250,
                    participants: 45,
                    status: 'active',
                    progress: 30,
                    user_joined: false,
                    difficulty: 'easy',
                    category: '친환경배송'
                }
            ];
        }

        // 챌린지 렌더링
        function renderChallenges(challenges) {
            const grid = document.getElementById('challengesGrid');

            if (challenges.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                        <i class="fas fa-seedling" style="font-size: 3rem; color: #ddd; margin-bottom: 1rem;"></i>
                        <p>활성 챌린지가 없습니다.</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = challenges.map(challenge => {
                const difficultyColor = {
                    'easy': '#28a745',
                    'medium': '#ffc107',
                    'hard': '#dc3545'
                };

                const statusText = challenge.user_joined ?
                    (challenge.progress === 100 ? '완료됨' : '참여중') : '새로운';
                const statusClass = challenge.progress === 100 ? 'completed' :
                    (challenge.user_joined ? 'active' : 'new');

                return `
                    <div class="challenge-card" onclick="viewChallenge('${challenge.challenge_id}')">
                        <div class="challenge-status ${statusClass}">
                            ${statusText}
                        </div>

                        <div class="challenge-icon">
                            ${getChallengeIcon(challenge.category)}
                        </div>

                        <h3 class="challenge-title">${challenge.title}</h3>
                        <p class="challenge-desc">${challenge.description}</p>

                        <div class="challenge-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${challenge.progress}%"></div>
                            </div>
                            <div class="progress-text">
                                <span>진행률: ${challenge.progress}%</span>
                                <span style="color: ${difficultyColor[challenge.difficulty]}">
                                    ${challenge.difficulty.toUpperCase()}
                                </span>
                            </div>
                        </div>

                        <div class="challenge-reward">
                            <i class="fas fa-coins" style="color: #ffc107;"></i>
                            <strong>+${challenge.reward_points} 에코포인트</strong>
                            <span style="margin-left: auto;">-${challenge.target_reduction}kg CO₂</span>
                        </div>

                        <div class="challenge-participants">
                            <i class="fas fa-users"></i>
                            <span>${challenge.participants}명 참여중</span>
                            <div class="participant-avatars">
                                ${Array.from({length: Math.min(5, Math.floor(challenge.participants/20))}, (_, i) => `
                                    <div class="participant-avatar">${String.fromCharCode(65 + i)}</div>
                                `).join('')}
                                ${challenge.participants > 100 ? '<div class="participant-avatar">+</div>' : ''}
                            </div>
                        </div>

                        <div class="challenge-actions">
                            ${challenge.user_joined ?
                                (challenge.progress === 100 ?
                                    `<button class="btn btn-success" disabled>
                                        <i class="fas fa-check"></i> 완료!
                                    </button>` :
                                    `<button class="btn btn-primary" onclick="event.stopPropagation(); updateProgress('${challenge.challenge_id}')">
                                        <i class="fas fa-chart-line"></i> 진행 업데이트
                                    </button>`
                                ) :
                                `<button class="btn btn-primary" onclick="event.stopPropagation(); joinChallenge('${challenge.challenge_id}')">
                                    <i class="fas fa-play"></i> 도전하기
                                </button>`
                            }
                            <button class="btn btn-outline" onclick="event.stopPropagation(); shareChallenge('${challenge.challenge_id}')">
                                <i class="fas fa-share"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 챌린지 아이콘 가져오기
        function getChallengeIcon(category) {
            const icons = {
                '로컬푸드': '<i class="fas fa-map-marker-alt"></i>',
                '제로웨이스트': '<i class="fas fa-recycle"></i>',
                '유기농': '<i class="fas fa-seedling"></i>',
                '식단관리': '<i class="fas fa-apple-alt"></i>',
                '제철음식': '<i class="fas fa-calendar-alt"></i>',
                '친환경배송': '<i class="fas fa-bicycle"></i>'
            };
            return icons[category] || '<i class="fas fa-leaf"></i>';
        }

        // 리더보드 로드
        async function loadLeaderboard() {
            // 데모 리더보드 데이터
            const demoLeaderboard = [
                { rank: 1, name: '에코김선생', level: '환경수호자', score: -45.2, avatar: '김' },
                { rank: 2, name: '친환경박씨', level: '에코워리어', score: -38.7, avatar: '박' },
                { rank: 3, name: '로컬이씨', level: '그린리더', score: -32.1, avatar: '이' },
                { rank: 4, name: '제로웨최씨', level: '에코워리어', score: -28.9, avatar: '최' },
                { rank: 5, name: '유기농정씨', level: '그린비기너', score: -25.4, avatar: '정' },
                { rank: 6, name: '지구지킴이', level: '에코워리어', score: -22.8, avatar: '지' },
                { rank: 7, name: '당신', level: '에코워리어', score: -12.5, avatar: '나', isCurrentUser: true }
            ];

            renderLeaderboard(demoLeaderboard);
        }

        // 리더보드 렌더링
        function renderLeaderboard(leaderboard) {
            const list = document.getElementById('leaderboardList');

            list.innerHTML = leaderboard.map(user => {
                const rankClass = user.rank === 1 ? 'gold' :
                                  user.rank === 2 ? 'silver' :
                                  user.rank === 3 ? 'bronze' : 'other';

                return `
                    <li class="leaderboard-item" ${user.isCurrentUser ? 'style="background: #e8f5e8; border: 2px solid #27ae60; border-radius: 10px;"' : ''}>
                        <div class="leaderboard-rank ${rankClass}">
                            ${user.rank <= 3 ?
                                (user.rank === 1 ? '🥇' : user.rank === 2 ? '🥈' : '🥉') :
                                user.rank
                            }
                        </div>
                        <div class="leaderboard-user">
                            <div class="user-avatar">${user.avatar}</div>
                            <div class="user-info">
                                <h4>${user.name} ${user.isCurrentUser ? '(나)' : ''}</h4>
                                <div class="user-level">${user.level}</div>
                            </div>
                        </div>
                        <div class="leaderboard-score">
                            <div class="score-value">${user.score}kg</div>
                            <div class="score-label">CO₂ 절약</div>
                        </div>
                    </li>
                `;
            }).join('');
        }

        // 히어로 통계 업데이트
        function updateHeroStats() {
            // 실제로는 API에서 가져올 데이터
            const stats = {
                totalCarbon: -2847,
                participants: 1234,
                activeChallenges: 15,
                successRate: 89
            };

            // 애니메이션 효과로 숫자 카운팅할 수 있음
        }

        // 챌린지 참여
        function joinChallenge(challengeId) {
            showNotification('챌린지에 참여했습니다! 🎉', 'success');

            // UI 업데이트 (실제로는 서버 통신 후)
            setTimeout(() => {
                loadChallenges();
                userData.activeChallenges++;
            }, 500);
        }

        // 챌린지 진행 업데이트
        function updateProgress(challengeId) {
            const progress = prompt('현재 진행률을 입력하세요 (0-100):');
            if (progress && !isNaN(progress) && progress >= 0 && progress <= 100) {
                showNotification(`진행률이 ${progress}%로 업데이트되었습니다! 🚀`, 'success');

                // UI 업데이트
                setTimeout(() => {
                    loadChallenges();
                }, 500);
            }
        }

        // 챌린지 상세보기
        function viewChallenge(challengeId) {
            // 실제로는 상세 페이지나 모달로 이동
            alert(`챌린지 상세 정보:
ID: ${challengeId}

상세 페이지는 개발 중입니다! 🚧
참여 방법, 진행 현황, 커뮤니티 피드를 확인할 수 있습니다.`);
        }

        // 챌린지 공유
        function shareChallenge(challengeId) {
            if (navigator.share) {
                navigator.share({
                    title: 'PAM-TALK 탄소 챌린지',
                    text: '함께 지구를 구해요! 탄소발자국 줄이기 챌린지에 참여하세요.',
                    url: `${window.location.origin}/challenges/${challengeId}`
                });
            } else {
                // 클립보드에 복사
                const url = `${window.location.origin}/challenges/${challengeId}`;
                navigator.clipboard.writeText(url).then(() => {
                    showNotification('링크가 클립보드에 복사되었습니다! 📋', 'success');
                });
            }
        }

        // 새 챌린지 생성
        function createChallenge() {
            alert(`새 챌린지 제안하기! 💡

다음 정보를 입력하세요:
- 챌린지 제목
- 목표 탄소 절약량
- 기간
- 참여 방법
- 보상 포인트

챌린지 생성 폼은 개발 중입니다! 🚧`);
        }

        // 알림 표시
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // 스핀 애니메이션 CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>